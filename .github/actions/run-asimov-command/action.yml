name: 'Run Asimov Command'
description: 'Execute asimov command as submituser'
inputs:
  script:
    description: 'Full sript to run inside the asimov env (include the asimov CLI if needed)'
    required: true


runs:
  using: "composite"
  steps:
    - name: Run asimov command
      shell: bash -el {0}
      run: |

        CONDA_EXE="${CONDA_EXE:-${CONDA:-/usr/share/miniconda}/bin/conda}"
        if [ ! -x "$CONDA_EXE" ]; then
          echo "Conda not found at $CONDA_EXE" >&2
          exit 1
        fi
        ASIMOV_CMD="$CONDA_EXE run -n asimov"

        su - submituser <<EOF
        set -euo pipefail
        cd "$GITHUB_WORKSPACE"
        COMMAND_SAFE=$(printf '%q' '${{ inputs.script }}')
        "$ASIMOV_CMD" bash -c $COMMAND_SAFE
        EOF